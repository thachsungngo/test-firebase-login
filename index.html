<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>áº¨n hoÃ n toÃ n ná»™i dung</title>
</head>
<body>
    <h1>ğŸ” Ná»™i dung chá»‰ hiá»ƒn thá»‹ sau khi Ä‘Äƒng nháº­p</h1>

    <!-- ğŸ”˜ NÃºt Ä‘Äƒng nháº­p / Ä‘Äƒng xuáº¥t -->
    <button id="login-btn">ÄÄƒng nháº­p vá»›i Google</button>
    <button id="logout-btn" style="display: none;">ÄÄƒng xuáº¥t</button>

    <!-- ğŸ“Œ Khu vá»±c hiá»ƒn thá»‹ ná»™i dung -->
    <div id="hidden-content" style="display: none;">
        <h2>ğŸ­ ChÃ o má»«ng! ÄÃ¢y lÃ  bÃ i thÆ¡ bÃ­ máº­t:</h2>
        <p id="poem">Äang táº£i...</p>
        <h2>ğŸ–¼ HÃ¬nh áº£nh bÃ­ máº­t:</h2>
        <img id="hidden-image" src="" alt="HÃ¬nh bÃ­ máº­t" style="display: none; max-width: 300px;">
    </div>

    <script type="module">
        // âœ… Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // âœ… Cáº¥u hÃ¬nh Firebase (Thay báº±ng config cá»§a báº¡n)
        const firebaseConfig = {
            apiKey: "AIzaSyBZ_4LtXw5_sSZ4bi5NFKrnSxwDVedSWcg",
            authDomain: "membership-1c8c5.firebaseapp.com",
            projectId: "membership-1c8c5",
            storageBucket: "membership-1c8c5.firebasestorage.app",
            messagingSenderId: "134419560626",
            appId: "1:134419560626:web:ed4d05d31e18784de7f1ab"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();

        // âœ… ÄÄƒng nháº­p vá»›i Google
        document.getElementById("login-btn").addEventListener("click", () => {
            const provider = new GoogleAuthProvider();
            signInWithPopup(auth, provider).catch(error => {
                console.error("Lá»—i Ä‘Äƒng nháº­p:", error);
            });
        });

        // âœ… ÄÄƒng xuáº¥t
        document.getElementById("logout-btn").addEventListener("click", () => {
            signOut(auth).then(() => {
                alert("Báº¡n Ä‘Ã£ Ä‘Äƒng xuáº¥t!");
            });
        });

        // âœ… Kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById("login-btn").style.display = "none";
                document.getElementById("logout-btn").style.display = "block";
                await loadHiddenContent();
            } else {
                document.getElementById("hidden-content").style.display = "none";
                document.getElementById("login-btn").style.display = "block";
                document.getElementById("logout-btn").style.display = "none";
            }
        });

        // âœ… Láº¥y dá»¯ liá»‡u tá»« Firestore khi Ä‘Äƒng nháº­p
        async function loadHiddenContent() {
            const docRef = doc(db, "privateContent", "hiddenPoem");
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                document.getElementById("poem").innerText = docSnap.data().content;
                document.getElementById("hidden-content").style.display = "block";
            } else {
                document.getElementById("poem").innerText = "KhÃ´ng tÃ¬m tháº¥y ná»™i dung.";
            }

            // ğŸ”¥ Láº¥y URL hÃ¬nh áº£nh tá»« Firestore
            const imgRef = doc(db, "privateContent", "hiddenImage");
            const imgSnap = await getDoc(imgRef);
            if (imgSnap.exists()) {
                document.getElementById("hidden-image").src = imgSnap.data().url;
                document.getElementById("hidden-image").style.display = "block";
            } else {
                console.warn("KhÃ´ng tÃ¬m tháº¥y hÃ¬nh áº£nh.");
            }
        }
    </script>
</body>
</html>
